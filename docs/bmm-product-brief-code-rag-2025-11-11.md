# Product Brief: code-rag

**Date:** 2025-11-11
**Author:** commander
**Context:** greenfield

---

## Executive Summary

code-rag 是面向企业内网的代码增强型知识库，为业务智能体与工作流提供高准确度的上下文支持。产品核心目标是让“业务 agent”理解开发者诉求后，能在 5 秒内检索并生成贴合需求的业务代码，准确率达 95% 以上。系统整合飞书文档、GitLab 代码库与后端数据库，支持代码模板、公共组件库和业务 PRD 的快速定位，确保生成的代码可追溯、可验证、可维护。凭借内网部署、数据脱敏与开源组件组合，单人也能高效运营与持续扩展。

---

## Core Vision

### Problem Statement

企业内部的业务开发工程师需要在快速迭代中理解需求、寻找代码范例、复用公共组件，却被信息分散、沟通耗时与代码参考不统一拖累。当前工作流中，需求文档散落于飞书、代码模板存在多版本分叉，数据库中的业务数据也缺少统一入口，导致业务 agent 难以在短时间内给出可靠的代码输出。

### Problem Impact

- 研发效率下降：开发者为对齐需求与寻找用例投入大量时间，迭代周期被拉长。
- 代码质量不稳定：缺少统一模板与上下文，重复实现和差异化实现增加维护成本。
- 沟通成本高：业务、开发、运维之间需要多轮确认，阻碍自动化工作流的落地。

### Proposed Solution

构建可内网部署、支持数据脱敏的代码增强型 RAG 知识库：通过统一的索引与查询引擎，整合飞书文档、GitLab 代码库、后端数据库等数据源。业务 agent 在接收到开发者诉求后，可在 5 秒内检索并组合相关 PRD、公共组件、代码模板，生成可审计的业务代码，并附带来源引用，确保可追溯与可维护。

---

## Target Users

### Primary Users

- 企业内部业务开发工程师：需要高效获取需求上下文、代码范例与组件库信息，以快速交付可靠功能。
- 控制工作流的业务 agent：负责理解开发诉求、检索知识库并生成初始代码或建议。

### User Journey

1. 工程师提出业务需求或功能迭代请求。
2. 业务 agent 解析诉求，通过知识库检索飞书 PRD、GitLab 模板、数据库上下文。
3. agent 在 5 秒内生成初版代码或实现提示，附带引用路径与解释。
4. 工程师审查、调整并提交，工作流记录来源与操作，减少后续沟通成本。

---

## Success Metrics

- 平均检索耗时 ≤ 5 秒
- 检索命中率 ≥ 95%，Agent 推荐被采纳率持续提升
- 人工 review 时间缩短（目标 50% 以内）
- 沟通轮数减少，迭代周期缩短，返工率显著降低

### Key Performance Indicators

- 检索延迟 / 吞吐量监控
- 命中率与采纳率指标面板
- Review 周期时长、需求沟通轮数、返工次数等运营指标

---

## MVP Scope

### Core Features

- 多数据源同步（飞书文档、GitLab 代码库、后端数据库）
- 语义检索与代码片段预览，确保上下文完整可读
- 引用追踪：展示 PRD、模板、组件的来源链接与元信息
- 兼容业务 agent 的接口，为工作流提供统一检索服务

### Future Vision

- 自动修复提示与代码改进建议
- 扩展更多数据源（监控日志、测试用例等）
- 引入评测面板，追踪准确度、延迟、用户反馈等指标

---

## Technical Preferences

- 保持 Node.js/TypeScript 或 Python 技术栈，结合容器化部署
- 内网自建数据库与数据脱敏流水线
- 引入可视化面板与数据输出能力，向管理层展示价值与使用情况
- 兼顾合规要求（权限控制、访问审计、数据留存）

---

## Organizational Context

- 支撑内部自动化工作流与业务 agent 战略，向管理层证明 AI 辅助开发的效益
- 需满足企业合规要求：数据脱敏、操作审计、访问控制
- 管理层期望通过可视化面板看到检索表现、效率提升等关键指标

---

## Risks and Assumptions

- 模型效果风险：嵌入与检索模型需持续调优，确保 95% 准确度目标
- 数据质量风险：文档、代码与数据库存在不一致/过期内容，需要清洗与同步机制
- 运维压力：单人维护要求高度自动化的部署、监控与告警体系
- 假设业务团队愿意提供及时反馈，支持知识库持续完善

---

## Timeline

- 优先完成 MVP 关键流程（多源同步、检索与引用追踪），尽早交付可用版本
- 未来迭代：引入自动修复提示、更多数据源、评测与可视化面板，以支撑管理层与合规目标

---
